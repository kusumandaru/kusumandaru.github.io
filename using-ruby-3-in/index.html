<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>Using Ruby 3 in Rails 6 | Kusumandaru</title>

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Using Ruby 3 in Rails 6 | Kusumandaru</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Using Ruby 3 in Rails 6" />
<meta name="author" content="ndaru" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="And how much performance increase Ruby 3 has been released on 25 December 2020, and increase speed performance almost 3 times when compare with Ruby 2.0 (not latest one 2.7.2) and also when using JIT. We will try to check live world performance using Ruby on Rails 6. As comparison we check speed using ruby 2.7.2 (latest Ruby 2 when these article published) instead long ago Ruby 2.0.0. Ruby is interpreted language, it need to read source code and gets broken down into byte code and sent an interpreter to be executed. On other side, compiled language like Java, Swift, C, program which you’re writing, need to turn it into a native application. Then you run that compiled code. JIT — Just In Time acronym is a hybrid of compiled and interpreted languages. First it run on interpreted, and when found some method / function called in multiple times, it compiled that specific function to got optimisation effect. JIT already birth on Ruby 2.6, but it show some deformed performance in Rails because the process of optimising individual methods is slower since for larger and complex methods is actually slower than interpreting that method directly. And since each methods consume 2Mb memory it float exponentially and burden machines On Ruby 2.7, there is improvement for JIT like these articles, consist of JIT max size and minimize call size, de-optimized compilation and Frame-omitted method inlining. https://github.com/mame/optcarrot Installation brew update &amp;&amp; brew upgrade ruby-build rbenv install 3.0.0 rbenv local 3.0.0 gem install rails rails new ruby3 -d postgresql Add some gem for test and benchmark gem &#39;rspec-rails&#39; gem &#39;rspec-benchmark&#39; gem &#39;rexml&#39; # stream parsing need for Rails 6 # add require &#39;rexml/document&#39; on application.rb Now we try to test with several aspect, with use Ruby 2.7.2, Ruby 2.7.2 JIT, Ruby 3.0.0 and Ruby 3.0.0 JIT https://medium.com/media/349b82cdc4fecb9f2f57f6a169daee8f/href benchmark For above benchmark, we run 3 times to got average speed. Speed is increase about 8 percent only in same function, for database interaction (active record) and cpu intensive task it not have some improvement. At least it not slow down Rails 6 as before Ruby 2.6 release. see these articles So is it worth it to move from Ruby 2.7 to Ruby 3? If you just common Rails consumer which need day to day operation to database, message broker or third party, improvement is par. But if you need power of concurrency for internal calculation or parallel request like Ractor, along with Async Fiber you can considered to move into Ruby 3" />
<meta property="og:description" content="And how much performance increase Ruby 3 has been released on 25 December 2020, and increase speed performance almost 3 times when compare with Ruby 2.0 (not latest one 2.7.2) and also when using JIT. We will try to check live world performance using Ruby on Rails 6. As comparison we check speed using ruby 2.7.2 (latest Ruby 2 when these article published) instead long ago Ruby 2.0.0. Ruby is interpreted language, it need to read source code and gets broken down into byte code and sent an interpreter to be executed. On other side, compiled language like Java, Swift, C, program which you’re writing, need to turn it into a native application. Then you run that compiled code. JIT — Just In Time acronym is a hybrid of compiled and interpreted languages. First it run on interpreted, and when found some method / function called in multiple times, it compiled that specific function to got optimisation effect. JIT already birth on Ruby 2.6, but it show some deformed performance in Rails because the process of optimising individual methods is slower since for larger and complex methods is actually slower than interpreting that method directly. And since each methods consume 2Mb memory it float exponentially and burden machines On Ruby 2.7, there is improvement for JIT like these articles, consist of JIT max size and minimize call size, de-optimized compilation and Frame-omitted method inlining. https://github.com/mame/optcarrot Installation brew update &amp;&amp; brew upgrade ruby-build rbenv install 3.0.0 rbenv local 3.0.0 gem install rails rails new ruby3 -d postgresql Add some gem for test and benchmark gem &#39;rspec-rails&#39; gem &#39;rspec-benchmark&#39; gem &#39;rexml&#39; # stream parsing need for Rails 6 # add require &#39;rexml/document&#39; on application.rb Now we try to test with several aspect, with use Ruby 2.7.2, Ruby 2.7.2 JIT, Ruby 3.0.0 and Ruby 3.0.0 JIT https://medium.com/media/349b82cdc4fecb9f2f57f6a169daee8f/href benchmark For above benchmark, we run 3 times to got average speed. Speed is increase about 8 percent only in same function, for database interaction (active record) and cpu intensive task it not have some improvement. At least it not slow down Rails 6 as before Ruby 2.6 release. see these articles So is it worth it to move from Ruby 2.7 to Ruby 3? If you just common Rails consumer which need day to day operation to database, message broker or third party, improvement is par. But if you need power of concurrency for internal calculation or parallel request like Ractor, along with Async Fiber you can considered to move into Ruby 3" />
<link rel="canonical" href="https://kusumandaru.com/using-ruby-3-in/" />
<meta property="og:url" content="https://kusumandaru.com/using-ruby-3-in/" />
<meta property="og:site_name" content="Kusumandaru" />
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*fOzmp_fk3jZUp8kp.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-03T00:00:00+07:00" />
<script type="application/ld+json">
{"headline":"Using Ruby 3 in Rails 6","dateModified":"2021-01-03T00:00:00+07:00","datePublished":"2021-01-03T00:00:00+07:00","author":{"@type":"Person","name":"ndaru"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://kusumandaru.com/assets/images/logo.png"},"name":"ndaru"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kusumandaru.com/using-ruby-3-in/"},"url":"https://kusumandaru.com/using-ruby-3-in/","description":"And how much performance increase Ruby 3 has been released on 25 December 2020, and increase speed performance almost 3 times when compare with Ruby 2.0 (not latest one 2.7.2) and also when using JIT. We will try to check live world performance using Ruby on Rails 6. As comparison we check speed using ruby 2.7.2 (latest Ruby 2 when these article published) instead long ago Ruby 2.0.0. Ruby is interpreted language, it need to read source code and gets broken down into byte code and sent an interpreter to be executed. On other side, compiled language like Java, Swift, C, program which you’re writing, need to turn it into a native application. Then you run that compiled code. JIT — Just In Time acronym is a hybrid of compiled and interpreted languages. First it run on interpreted, and when found some method / function called in multiple times, it compiled that specific function to got optimisation effect. JIT already birth on Ruby 2.6, but it show some deformed performance in Rails because the process of optimising individual methods is slower since for larger and complex methods is actually slower than interpreting that method directly. And since each methods consume 2Mb memory it float exponentially and burden machines On Ruby 2.7, there is improvement for JIT like these articles, consist of JIT max size and minimize call size, de-optimized compilation and Frame-omitted method inlining. https://github.com/mame/optcarrot Installation brew update &amp;&amp; brew upgrade ruby-build rbenv install 3.0.0 rbenv local 3.0.0 gem install rails rails new ruby3 -d postgresql Add some gem for test and benchmark gem &#39;rspec-rails&#39; gem &#39;rspec-benchmark&#39; gem &#39;rexml&#39; # stream parsing need for Rails 6 # add require &#39;rexml/document&#39; on application.rb Now we try to test with several aspect, with use Ruby 2.7.2, Ruby 2.7.2 JIT, Ruby 3.0.0 and Ruby 3.0.0 JIT https://medium.com/media/349b82cdc4fecb9f2f57f6a169daee8f/href benchmark For above benchmark, we run 3 times to got average speed. Speed is increase about 8 percent only in same function, for database interaction (active record) and cpu intensive task it not have some improvement. At least it not slow down Rails 6 as before Ruby 2.6 release. see these articles So is it worth it to move from Ruby 2.7 to Ruby 3? If you just common Rails consumer which need day to day operation to database, message broker or third party, improvement is par. But if you need power of concurrency for internal calculation or parallel request like Ractor, along with Async Fiber you can considered to move into Ruby 3","@type":"BlogPosting","image":"https://cdn-images-1.medium.com/max/1024/0*fOzmp_fk3jZUp8kp.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>

<!-- change your GA id in _config.yml -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-135970453-1', 'auto');
ga('send', 'pageview');
</script>


<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Kusumandaru">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

                <li class="nav-item" hidden=true>
                <a target="_blank" class="nav-link" href="https://bootstrapstarter.com/bootstrap-templates/template-mediumish-bootstrap-jekyll/"> Docs</a>
                </li>

                <li class="nav-item" hidden=true>
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item" hidden=true>
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li>

                <li class="nav-item" hidden=true>
                <a target="_blank" class="nav-link" href="https://github.com/wowthemesnet/mediumish-theme-jekyll"><i class="fab fa-github"></i> Fork on Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Kusumandaru</h1>
    <p class="lead">
        Collection of medium story
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Using Ruby 3 in Rails 6&url=https://kusumandaru.com/using-ruby-3-in/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=https://kusumandaru.com/using-ruby-3-in/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://kusumandaru.com/using-ruby-3-in/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="https://www.gravatar.com/avatar/8e79c68c1efe61afb4ae962aa41f8ea8?s=250&d=mm&r=x" alt="ndaru">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://kusumandaru.com">ndaru</a><a target="_blank" href="" class="btn follow">Follow</a>
                        <span class="author-description">digital entushiast</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Using Ruby 3 in Rails 6</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid lazyimg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="https://cdn-images-1.medium.com/max/1024/0*fOzmp_fk3jZUp8kp.png" alt="Using Ruby 3 in Rails 6">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <p>And how much performance increase</p>
<p><a href="https://www.ruby-lang.org/en/news/2020/12/25/ruby-3-0-0-released/">Ruby 3</a> has been released on 25 December 2020, and increase speed performance almost 3 times when compare with Ruby 2.0 (not latest one 2.7.2) and also when using JIT. We will try to check live world performance using Ruby on Rails 6. As comparison we check speed using ruby 2.7.2 (latest Ruby 2 when these article published) instead long ago Ruby 2.0.0.</p>
<p>Ruby is interpreted language, it need to read source code and gets broken down into byte code and sent an interpreter to be executed. On other side, compiled language like Java, Swift, C, program which you’re writing, need to turn it into a native application. Then you run that compiled code.</p>
<p>JIT — Just In Time acronym is a hybrid of compiled and interpreted languages. First it run on interpreted, and when found some method / function called in multiple times, it compiled that specific function to got optimisation effect.</p>
<p>JIT already birth on Ruby 2.6, but it show some deformed performance in Rails because the process of optimising individual methods is slower since for larger and complex methods is actually slower than interpreting that method directly. And since each methods consume 2Mb memory it float exponentially and burden machines</p>
<p>On Ruby 2.7, there is improvement for JIT like<a href="https://medium.com/@k0kubun/jit-development-progress-at-ruby-2-7-d6dd62a8c76a"> these articles</a>, consist of JIT max size and minimize call size, de-optimized compilation and Frame-omitted method inlining.</p>
<figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*fOzmp_fk3jZUp8kp.png" /><figcaption><a href="https://github.com/mame/optcarrot">https://github.com/mame/optcarrot</a></figcaption></figure>
<ul><li>Installation</li></ul>
<pre>brew update &amp;&amp; brew upgrade ruby-build</pre>
<pre>rbenv install 3.0.0</pre>
<pre>rbenv local 3.0.0</pre>
<pre>gem install rails</pre>
<pre>rails new ruby3 -d postgresql</pre>
<ul><li>Add some gem for test and benchmark</li></ul>
<pre>gem &#39;rspec-rails&#39;</pre>
<pre>gem &#39;rspec-benchmark&#39;</pre>
<pre>gem &#39;rexml&#39; <br /># stream parsing need for Rails 6 <br /># add require &#39;rexml/document&#39; on application.rb</pre>
<p>Now we try to test with several aspect, with use Ruby 2.7.2, Ruby 2.7.2 JIT, Ruby 3.0.0 and Ruby 3.0.0 JIT</p>
<iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/349b82cdc4fecb9f2f57f6a169daee8f/href">https://medium.com/media/349b82cdc4fecb9f2f57f6a169daee8f/href</a></iframe>
<figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*AoeQp4yvngWruY0FGGIdZg.png" /><figcaption>benchmark</figcaption></figure>
<p>For above benchmark, we run 3 times to got average speed. Speed is increase about 8 percent only in same function, for database interaction (active record) and cpu intensive task it not have some improvement.<strong> At least it not slow down Rails 6 as before Ruby 2.6 release. </strong><a href="https://blog.heroku.com/ruby-just-in-time-compilation">see these articles</a></p>
<p>So is it worth it to move from Ruby 2.7 to Ruby 3?</p>
<p>If you just common Rails consumer which need day to day operation to database, message broker or third party, improvement is par.</p>
<p>But if you need power of concurrency for internal calculation or parallel request like <a href="https://www.ruby-lang.org/en/news/2020/12/25/ruby-3-0-0-released/">Ractor, along with Async Fiber</a> you can considered to move into Ruby 3</p>
<p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=761fa148571" width="1" height="1" alt="" /></p>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2021-01-03">03 Jan 2021</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#just-in-time">just-in-time</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#rails">rails</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#ruby">ruby</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#ruby-on-rails">ruby-on-rails</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="https://kusumandaru.com//deploy-jekyll-i/"> &laquo; Deploy Jekyll in Heroku with Custom Domain</a>
            
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'kusumandaru'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


    
</div>


<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2021 Kusumandaru 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right" hidden=true>    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>


<script src="/assets/js/lazyload.js"></script>


<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//kusumandaru.disqus.com/count.js"></script>


</body>
</html>
